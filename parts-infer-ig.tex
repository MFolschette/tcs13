% vim:spell spelllang=en:
\section{Interaction Graph Inference from Process Hitting}\label{sec:infer-IG}

\todo{In this while section: add informal explanations and maybe more examples.\\
Especially:
\begin{itemize}
  \item Intuitively detail the motivations
  \item Give the intuition of the methods (esp. $\focals$)
  \item Insist on the use/motivation of the definitions
\end{itemize}
The reviewer also proposes to use a biological running example (such as $\lambda$-phage).}

The Interaction Graph (IG) is an abstract representation of the direct qualitative influences,
positive and/or negative, between the components of the system.
As discussed in \pref{sec:intro}, the IG allows to efficiently characterize global dynamical
properties for the concrete system, such as the capability for multi-stationarity or oscillation.

\todo{The reviewer says about the following paragraph: “The inference of an
IG from a dynamics is interesting and important in biology. However the
motivations expressed here are not well argued. In particular I don't find
this “common”. Some bibliographical references are required to consolidate
the arguments or the sentence has to be rephrased.”}

In a typical biological network modeling process, a prior IG is generally the starting point for
the formal system specification.
However, it is common that the prior IG actually refers to interactions that reveal to be 
non-effective with respect to the dynamics.
Hence, deriving the IG directly from the dynamical models lead to more concise IGs, enhancing the
conclusiveness of static analyses based upon this abstract representation.

We aim at inferring that $b$ activates (inhibits) $a$ if there exists a configuration where increasing
the level of $b$ makes possible the increase (decrease) of the level of $a$,
which is directly inspired from the works of~\cite{Richard2010378}.

We consider hereafter a global PH $(\PHs,\PHl,\PHa)$ and a parition of sorts
$\Gamma \cup \Delta=\PHs$ satisfying \pref{pro:wf-ph} on which the IG inference is to be
performed.
\todo{outline}


\subsection{Inference of Influences}\label{ssec:infer-IG}

\todo{rework text with new paper structure (\pref{sec:tr2global})}

At this point we can divide the set of sorts $\PHs$ into components ($\Gamma$, see \pref{eq:PH-components}) and cooperative sorts
that will not appear in the IG ($\PHs \setminus \Gamma$).

\def\fp{\Phi}


\modLP{
\begin{equation}
\fp(a_i) \DEF \{\sigma\in L(\PHpredecgene{a}\cup\{a\}) \mid a_i\in\sigma \wedge
					\focals(a, \{a_i\}, \ctx_a^{\PHpredecgene{a}}(\sigma)) =
					\{a_i\} \}
\label{eq:fp}
\end{equation}
}


To infer influence of a component $b$ on a component $a$,
we observe the direction of evolution of $a$ for different active processes of $b$.
The fact that $a$ tends to evolve differently when $b$ changes denotes an influence from $b$.
Formally, for a given group $g$ of regulators of a component $a$
(that is, a minimal set of components regulating $a$ through common cooperative sorts),
and a configuration $\ctx$ on $g$, we note
$\irB_a(\sigma)$ the set of processes towards which $a$ can bounce (\pref{eq:possible-bounces}).
%This set is defined using the set $\irF_a(\sigma)$ of action hitting $\PHget{\sigma}{a}$ in $\sigma$ (\pref{eq:possible-actions})
%and the set of processes $\ctx$ hitting any process of $a$ (\pref{eq:ctx-sigma}).
If $a$ cannot be hit by any action in $\sigma$, then $\irB_a(\sigma) = \{ \PHget{\sigma}{a} \}$.
%

\modLP{
$\forall g\in X(a), \forall \sigma\in L(g\cup\{a\}), i=\sigma[a]$:
\begin{align}
a_i \in \irB_a^g(\sigma) &\EQDEF \exists\sigma'\in\fp(a_i): \sigma\subset\sigma'
\label{eq:B-no-bounce}
\\
\forall a_j\in L_a, j\neq i,
a_j \in \irB_a^g(\sigma) &\EQDEF
\exists b_k\in\ctx_{g}(\sigma): \PHfrappe{b_k}{a_i}{a_j}\in\PHa
\label{eq:B-bounce}
\end{align}}

\pref{pps:inference-edges} details the inference of all existing influences between components occurring
with a threshold $t$.
The main idea of this inference is that
the presence of a positive (negative) influence of a component $b$ on $a$ denotes the fact that
there exists a state in which increasing the level of $b$ tends to make the future level of $a$ rise (drop)
(\pref{eq:edges-inference}).
Therefore, these influences are split into positive and negative ones, and represent possible edges in the final IG.
Furthermore, studying the influences of the groups of regulators of $a$
allows to study its auto-influences, and thus infer auto-edges on $a$ in the IG (\pref{eq:edges-inference-auto}).
Finally, \pref{eq:edges-inference-noreg} handles the special case where $a$ has no regulators.
We ignore the cases where a component has no visible influence on another.
%
\begin{proposition}[Influences inference]\label{pps:inference-edges}
We define the set of positive (resp. negative) influences $\hat{E}_+$ (resp.
$\hat{E}_-$) by
\modLP{
\begin{align}
\begin{split}
\forall a\in\Gamma, \forall b\in\PHpredecgene{a}, b\neq a, & \forall s \in \{ +, - \}, \forall t < l_b\\
  b \xrightarrow{t+1} a \in \hat{E}_s \EQDEF & \exists g \in X(a), 
  	b \in g, \exists \sigma \in L(g\cup\{a\}), \\
    \qquad & \exists a_j \in \irB_a^g(\sigma\{b_t\}), \exists a_k \in \irB_a^g(\sigma\{b_{t+1}\}), \\
	\qquad & k > j \wedge s=+  \vee j < t \wedge s=-
\end{split}
\\
\begin{split}
 \forall a\in\Gamma: a\in\PHpredecgene{a}, & \forall s \in \{ +, - \}, \forall t < l_a\\
  a \xrightarrow{t+1} a \in \hat{E}_s \EQDEF & \exists g \in X(a), 
  	 \exists \sigma \in L(g\cup\{a\}), \\
    \qquad & \exists a_j \in \irB_a^g(\sigma\{a_t\}), \exists a_k \in \irB_a^g(\sigma\{a_{t+1}\}), \\
	\qquad & k\geq t+1 \wedge j \leq t \wedge s=+ \\
	\qquad & \vee k<t+1 \wedge j>t \wedge s=-
\end{split}
\\
\forall a\in\Gamma: \PHpredecgene{a} = \emptyset, &
	\forall t\in\{0,\cdots,l_a-1\},
	a \xrightarrow{t+1} a \in \hat{E}_+
\end{align}
}
\end{proposition}

We are now able to infer the edges of the final IG by considering positive and negative influences
(\pref{pps:inference-IG}).
We infer a positive (resp. negative) edge if there only exist corresponding influences with the same sign.
If an influence is both positive and negative, we infer an unsigned edge.
In the end, the threshold of each edge is the minimum threshold for which an influence has been found.
%
\begin{proposition}[Interaction Graph inference]\label{pps:inference-IG}
We infer $\IG = (\Gamma,E)$ using \pref{pps:inference-edges} as follows:
\begin{align*}
E_+ &= \{ \GRNedge{a}{+}{t}{b} \mid \nexists a \xrightarrow{t'} b \in \hat{E}_-
  \wedge t = \min \{ l \mid a \xrightarrow{l} b \in \hat{E}_+\}\} \\
E_- &= \{ \GRNedge{a}{-}{t}{b} \mid \nexists a \xrightarrow{t'} b \in \hat{E}_+
  \wedge t = \min \{l \mid a \xrightarrow{l} b \in \hat{E}_-\}\} \\
E_\pm &= \{ \GRNedge{a}{\uns}{t}{b} \mid \exists a \xrightarrow{t'} b \in \hat{E}_+ \wedge \exists a \xrightarrow{t''} b \in \hat{E}_- \\
  & \qquad\qquad\qquad \wedge t = \min \{l \mid a \xrightarrow{l} b \in \hat{E}_- \cup \hat{E}_+\}\}
\end{align*}
\end{proposition}


\subsection{Examples}

The IG inference of the PH of \pref{fig:runningPH-2} gives the
IG in \pref{fig:BRN-inf1}, containing the following edges:
\begin{align*}
  E_+ &= \{\GRNedgef{b}{+}{1}{a}, \GRNedgef{c}{+}{1}{a}, \GRNedgef{a}{+}{1}{a}, \GRNedgef{b}{+}{1}{b}, \GRNedgef{c}{+}{1}{c}\}\\
  E_- &= \{\GRNedgef{a}{-}{2}{b}\} \qquad\qquad\qquad\qquad\qquad
  E_\uns = \emptyset
\end{align*}
This IG is close to the one in \pref{fig:runningBRN} but not equivalent,
as each component has an additional auto-action.
The auto-actions on $b$ and $c$ are the consequence of a global stability
in some configurations: $c$ never evolves, and neither does $b$ when $a_2$ is not active.
The auto-action on $a$ is mainly caused by its multi-valued nature.

The inference of the PH of \pref{fig:runningPH-1}
(without refinement with cooperative sort) gives the same IG.

\begin{figure}[t]
\centering
\scalebox{1.2}{
\begin{tikzpicture}[grn]
  \path[use as bounding box] (-1.3,-0.75) rectangle (3.5,1.5);
  \node[inner sep=0] (a) at (2,0) {a};
  \node[inner sep=0] (b) at (0,0) {b};
  \node[inner sep=0] (c) at (2,1.2) {c};
  \path[->]
    (b) edge[bend right] node[elabel, below=-2pt] {$+1$} (a)
    (c) edge node[elabel, right=-2pt] {$+1$} (a)
    (a) edge[bend right] node[elabel, above=-5pt] {$-2$} (b)
    (b) edge[in=-15+180, out=15+180, loop] node[elabel, left=-2pt] {+1} (b)
    (c) edge[in=15, out=-15, loop] node[elabel, right=-2pt] {+1} (c)
    (a) edge[in=15, out=-15, loop] node[elabel, right=-2pt] {+1} (a);
\end{tikzpicture}
}
\caption{\label{fig:BRN-inf1}
  Result of the IG inference performed on the PH of \pref{fig:runningPH-2}.
}
\end{figure}

If we add the action $\PHfrappe{a_2}{b_0}{b_1}$ to the PH of \pref{fig:runningPH-2},
then two unsigned edges towards $b$ are inferred instead of the previous signed edges:
\begin{align*}
  E_+ &= \{\GRNedgef{b}{+}{1}{a}, \GRNedgef{c}{+}{1}{a}, \GRNedgef{a}{+}{1}{a}, \GRNedgef{c}{+}{1}{c}\}\\
  E_- &= \emptyset \qquad\qquad\qquad\qquad
  E_\uns = \{\GRNedgef{a}{\uns}{2}{b}, \GRNedgef{b}{\uns}{1}{b}\}
\end{align*}
This is due to the fact that the actions $\PHfrappe{a_2}{b_1}{b_0}$ and $\PHfrappe{a_2}{b_0}{b_1}$
introduce an oscillation only caused by $a$, which cannot be represented in Thomas modeling.
