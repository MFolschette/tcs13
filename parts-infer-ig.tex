% vim:spell spelllang=en:
\section{Interaction Graph Inference from Process Hitting}\label{sec:infer-IG}

The Interaction Graph (IG) is an abstract representation of the direct qualitative influences,
positive and/or negative, between the components of the system.
As discussed in \pref{sec:intro}, the IG allows to efficiently characterize global dynamical
properties for the concrete system, such as the capability for multi-stationarity or oscillation.


\modLP{The inference of the IG also allows to check for the
consistency of the model with respect to prior knowledge on the influences.
This is the case for Thomas models, where a prior IG is required to specify the 
parameters of the dynamics.
Following \todo{ref Adrien, autre}, the IG of a dynamical model is consistent
with a prior IG if it is a sub-graph of the prior IG.
On the one hand, having influences in the model not references in the prior IG
indicates either mistakes in the encoding of the dynamics, or potential
influences that might need to be verified in the biological system.
One the other hand, some influences specified in the prior IG may not have been
necessary to encode the desired dynamics, indicating some non-minimality of the
prior IG \todo{more refs}.}

We consider hereafter a global PH $(\PHs,\PHl,\PHa)$ and a split of sorts
$\Gamma \cup \Delta=\PHs$ satisfying \pref{pro:wf-ph} on which the IG inference is to be
performed.
The inference of the IG is described in \pref{ssec:infer-IG}, and is illustrated
on small examples in \pref{ssec:infer-ig-examples}.


\subsection{Inference of Influences}\label{ssec:infer-IG}

\def\fp{\Phi}

We aim at inferring that $b$ activates (inhibits) $a$ if there exists a configuration where increasing
the level of $b$ makes possible the increase (decrease) of the level of $a$,
following the standard IG inference from Boolean and discrete networks \cite{Richard2010378}.
This can be seen as looking for changes of derivatives in the dynamics of $a$
when the configuration changes.

\pref{pps:inference-edges} details the inference of all existing influences between components occurring
with a threshold $t$.
\modLP{The inference relies on finding configurations $\sigma$ of groups $g$ of regulators of $a$
such that the increase of one of the regulator $b\in g$ from $b_t$ to $b_{t+1}$
changes the sign of the evolution of $a$.
If $b\neq a$ (\pref{eq:edges-inference}), this is achieved by finding a configuration $\sigma$ of $g$ and $a$ such
that there exists a bounce $a_j$ from $a_i$ in $\sigma\{b_t\}$ which is different
from a bounce $a_k$ from $a_i$ in $\sigma\{b_{t+1}\}$.
If so, $b$ regulates $a$ at threshold $t+1$ with the sign of $k-j$.
The case where  $b = a$ (\pref{eq:edges-inference-auto}) is similar: we look for
$a_t$ such that there exists a bounce in opposite direction in $\sigma\{a_t\}$
than in $\sigma\{a_{t+1}\}$.
If there is no bounce in one of these two configurations, we also need to ensure
that the configuration corresponds to a local fixed point between all the
regulators of $a$ (instead of in scope of $g$).
The set of configuration where no bounce occur on $a_i$ is given given by
$\fp(a_i)$ (\pref{eq:fp}).
In \pref{eq:edges-inference} and \pref{eq:edges-inference-auto} we use
$\irB_a^g(\sigma)$ as a shortcut for $\focals$, which returns the set of
possible bounces of $a$ in the configuration $\sigma$.}
Finally, when $a$ has no regulators, it derives that there is a positive self-influence
of $a$ for each level above $1$ (\pref{eq:edges-inference-noreg}).
\begin{proposition}[Influences inference]\label{pps:inference-edges}
We define the set of positive (resp. negative) influences $\hat{E}_+$ (resp.
$\hat{E}_-$) by
\modLP{
\begin{align}
\begin{split}
\forall a\in\Gamma, \forall b\in\PHpredecgene{a}, b\neq a, & \forall s \in \{ +, - \}, \forall t < l_b\\
  b \xrightarrow{t+1} a \in \hat{E}_s \EQDEF & \exists g \in X(a), 
  	b \in g, \exists \sigma \in L(g\cup\{a\}), \\
    \qquad & \exists a_j \in \irB_a^g(\sigma\{b_t\}), \exists a_k \in \irB_a^g(\sigma\{b_{t+1}\}), \\
	\qquad & k > j \wedge s=+  \vee k < j \wedge s=-
\end{split}
\label{eq:edges-inference}
\\
\begin{split}
 \forall a\in\Gamma: a\in\PHpredecgene{a}, & \forall s \in \{ +, - \}, \forall t < l_a\\
  a \xrightarrow{t+1} a \in \hat{E}_s \EQDEF & \exists g \in X(a), 
  	 \exists \sigma \in L(g\cup\{a\}), \\
    \qquad & \exists a_j \in \irB_a^g(\sigma\{a_t\}), \exists a_k \in \irB_a^g(\sigma\{a_{t+1}\}), \\
	\qquad & 
	(j=t \Rightarrow \exists \sigma'\in\fp(a_t): \sigma\{a_t\}\subseteq \sigma') \\
	\qquad & \wedge 
	(k=t+1 \Rightarrow \exists \sigma'\in\fp(a_{t+1}): \sigma\{a_{t+1}\}\subseteq \sigma') \\
	\qquad & \wedge k\geq t+1 \wedge j \leq t \wedge s=+ \\
	\qquad & \vee k<t+1 \wedge j>t \wedge s=-
\end{split}
\label{eq:edges-inference-auto}
\\
\forall a\in\Gamma: \PHpredecgene{a} = \emptyset, &
	\forall t\in\{0,\cdots,l_a-1\},
	a \xrightarrow{t+1} a \in \hat{E}_+
\label{eq:edges-inference-noreg}
\end{align}
where $\irB_a^g(\sigma) \DEF \focals(a, \{a_i\}, \ctx_a^g(\sigma))$ with
$a_i\in\sigma$,
and where $\fp(a_i) \subseteq  L(\PHpredecgene{a}\cup\{a\})$ is defined as follows:
\begin{equation}
\fp(a_i) \DEF \{\sigma\in L(\PHpredecgene{a}\cup\{a\}) \mid a_i\in\sigma \wedge
					\focals(a, \{a_i\}, \ctx_a^{\PHpredecgene{a}}(\sigma)) =
					\{a_i\} \}
\label{eq:fp}
\end{equation}
}
\end{proposition}

We are now able to infer the edges of the final IG by considering positive and negative influences
(\pref{pps:inference-IG}).
We infer a positive (resp. negative) edge if there only exist corresponding influences with the same sign.
If an influence is both positive and negative, we infer an unsigned edge.
In the end, the threshold of each edge is the minimum threshold for which an influence has been found.
\modLP{Note that as regulations matches with sign changes of the evolution of the
regulated components,
if two positive (negative) regulations from $b$ to $a$ have been inferred,
necessarily, a third regulation of opposite sign has been inferred in between.
The only exception is when $a$ is never hit ($\PHpredecgene{a} = \emptyset$), in
such a case, we arbitrarily pick the minimum threshold (1) for the
self-activation.}
%
\begin{proposition}[Interaction Graph inference]\label{pps:inference-IG}
We infer $\IG = (\Gamma,E)$ using \pref{pps:inference-edges} as follows:
\begin{align*}
E_- &= \{ \GRNedge{a}{-}{t}{b} \in \hat E_- \mid \nexists a \xrightarrow{t'} b
\in \hat{E}_+ \} \\
E_+ &= \{ \GRNedge{a}{+}{t}{b} \in \hat E_+ \mid \nexists a \xrightarrow{t'} b \in \hat{E}_-
  \wedge t = \min \{ l \mid a \xrightarrow{l} b \in \hat{E}_+\}\} \\
E_\pm &= \{ \GRNedge{a}{\uns}{t}{b} \mid \exists a \xrightarrow{t'} b \in \hat{E}_+ \wedge \exists a \xrightarrow{t''} b \in \hat{E}_- \\
  & \qquad\qquad\qquad \wedge t = \min \{l \mid a \xrightarrow{l} b \in \hat{E}_- \cup \hat{E}_+\}\}
\end{align*}
\end{proposition}


\subsection{Examples}
\label{ssec:infer-ig-examples}

The IG inference of the PH of \pref{fig:runningPH-2} gives the
IG in \pref{fig:BRN-inf1}, containing the following edges:
\begin{align*}
  E_+ &= \{\GRNedgef{b}{+}{1}{a}, \GRNedgef{c}{+}{1}{a}, \GRNedgef{a}{+}{1}{a}, \GRNedgef{b}{+}{1}{b}, \GRNedgef{c}{+}{1}{c}\}\\
  E_- &= \{\GRNedgef{a}{-}{2}{b}\} \qquad\qquad\qquad\qquad\qquad
  E_\uns = \emptyset
\end{align*}
This IG is close to the one in \pref{fig:runningBRN} but not equivalent,
as each component has an additional auto-action.
The auto-actions on $b$ and $c$ are the consequence of a global stability
in some configurations: $c$ never evolves, and neither does $b$ when $a_2$ is not active.
The auto-action on $a$ is mainly caused by its multi-valued nature.

The inference of the PH of \pref{fig:runningPH-1}
(without refinement with cooperative sort) gives the same IG.

\begin{figure}[t]
\centering
\scalebox{1.2}{
\begin{tikzpicture}[grn]
  \path[use as bounding box] (-1.3,-0.75) rectangle (3.5,1.5);
  \node[inner sep=0] (a) at (2,0) {a};
  \node[inner sep=0] (b) at (0,0) {b};
  \node[inner sep=0] (c) at (2,1.2) {c};
  \path[->]
    (b) edge[bend right] node[elabel, below=-2pt] {$+1$} (a)
    (c) edge node[elabel, right=-2pt] {$+1$} (a)
    (a) edge[bend right] node[elabel, above=-5pt] {$-2$} (b)
    (b) edge[in=-15+180, out=15+180, loop] node[elabel, left=-2pt] {+1} (b)
    (c) edge[in=15, out=-15, loop] node[elabel, right=-2pt] {+1} (c)
    (a) edge[in=15, out=-15, loop] node[elabel, right=-2pt] {+1} (a);
\end{tikzpicture}
}
\caption{\label{fig:BRN-inf1}
  Result of the IG inference performed on the PH of \pref{fig:runningPH-2}.
}
\end{figure}

If we add the action $\PHfrappe{a_2}{b_0}{b_1}$ to the PH of \pref{fig:runningPH-2},
then two unsigned edges towards $b$ are inferred instead of the previous signed edges:
\begin{align*}
  E_+ &= \{\GRNedgef{b}{+}{1}{a}, \GRNedgef{c}{+}{1}{a}, \GRNedgef{a}{+}{1}{a}, \GRNedgef{c}{+}{1}{c}\}\\
  E_- &= \emptyset \qquad\qquad\qquad\qquad
  E_\uns = \{\GRNedgef{a}{\uns}{2}{b}, \GRNedgef{b}{\uns}{1}{b}\}
\end{align*}
This is due to the fact that the actions $\PHfrappe{a_2}{b_1}{b_0}$ and $\PHfrappe{a_2}{b_0}{b_1}$
introduce an oscillation only caused by $a$, which cannot be represented in Thomas modeling.
